<template>
    <lightning-card title="Epic FHIR Connectivity Check" icon-name="standard:health_cloud">
        <!-- Status Header -->
        <div slot="actions">
            <lightning-button 
                label="Refresh" 
                icon-name="utility:refresh" 
                onclick={checkConnection}
                disabled={isLoading}>
            </lightning-button>
        </div>

        <div class="slds-p-around_medium">
            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <div class="slds-align_absolute-center slds-p-around_large">
                    <lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
                </div>
            </template>

            <template if:false={isLoading}>
                <!-- Connection Status -->
                <div class="slds-box slds-m-bottom_medium">
                    <div class="slds-grid slds-wrap">
                        <div class="slds-col slds-size_1-of-2 slds-p-around_small">
                            <p class="slds-text-title_caps slds-text-color_weak">Connection Status</p>
                            <p class={statusClass}>
                                <lightning-icon 
                                    icon-name={connectionStatus === 'Connected' ? 'utility:success' : 'utility:error'} 
                                    size="x-small" 
                                    class="slds-m-right_x-small">
                                </lightning-icon>
                                <strong>{connectionStatus}</strong>
                            </p>
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-around_small">
                            <p class="slds-text-title_caps slds-text-color_weak">FHIR Version</p>
                            <p><strong>{fhirVersion}</strong></p>
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-around_small">
                            <p class="slds-text-title_caps slds-text-color_weak">Publisher</p>
                            <p><strong>{publisher}</strong></p>
                        </div>
                        <div class="slds-col slds-size_1-of-2 slds-p-around_small">
                            <p class="slds-text-title_caps slds-text-color_weak">Supported Resources</p>
                            <p><strong>{resourceCount}</strong></p>
                        </div>
                    </div>
                </div>

                <!-- Error Display -->
                <template if:true={error}>
                    <div class="slds-notify slds-notify_alert slds-alert_error slds-m-bottom_medium" role="alert">
                        <lightning-icon icon-name="utility:error" variant="inverse" size="small" class="slds-m-right_x-small"></lightning-icon>
                        <span class="slds-assistive-text">error</span>
                        <h2>{error}</h2>
                    </div>
                </template>

                <!-- Supported Resources Table -->
                <template if:true={hasResources}>
                    <h3 class="slds-text-heading_small slds-m-bottom_small">Supported FHIR Resources</h3>
                    <div class="slds-scrollable_y" style="max-height: 300px;">
                        <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped">
                            <thead>
                                <tr class="slds-line-height_reset">
                                    <th scope="col"><div class="slds-truncate">Resource Type</div></th>
                                    <th scope="col"><div class="slds-truncate">Supported Interactions</div></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={resources} for:item="resource">
                                    <tr key={resource.type}>
                                        <td><div class="slds-truncate"><strong>{resource.type}</strong></div></td>
                                        <td><div class="slds-truncate">{resource.interactionList}</div></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </template>

                <!-- Raw JSON Toggle -->
                <div class="slds-m-top_medium">
                    <lightning-button 
                        label={toggleButtonLabel} 
                        onclick={toggleRawJson}
                        variant="neutral">
                    </lightning-button>
                </div>

                <template if:true={showRawJson}>
                    <div class="slds-m-top_small">
                        <h3 class="slds-text-heading_small slds-m-bottom_small">Raw Capability Statement</h3>
                        <div class="slds-box slds-scrollable_y" style="max-height: 400px; background: #1e1e1e;">
                            <pre style="color: #d4d4d4; font-size: 12px; white-space: pre-wrap;">{rawMetadata}</pre>
                        </div>
                    </div>
                </template>
            </template>
        </div>
    </lightning-card>
</template>
